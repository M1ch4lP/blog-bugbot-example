---
description: Use this when the user requests scaffolding of a new feature module in src/features using a specific Prisma model
alwaysApply: false
---

Follow this rule only when the user explicitly asks to create a new feature module and supplies (or references) a Prisma model that represents the business entity.

Steps:

1. Determine the module name from the Prisma model name (e.g., `model Comment` → `comment`) and create `src/features/<moduleName>`.
2. Read `@src/features/.cursor/BUGBOT.md` and ensure every convention in that document is respected while scaffolding.
3. Scaffolding outline (apply BUGBOT conventions for each part):
   - `index.ts` Fastify plugin that decorates this module’s repositories/services and registers command/query routes.
   - Root-level repository file(s) for the Prisma model (never inside `commands` or `queries`).
   - `commands/` and `queries/` folders containing the CQRS files (routes, schemas, services). Make sure that CQRS is related with business entity provided by the user
   - Commands: Create, Update, Delete routes (with matching schemas/services) - use prisma entity for business context.
   - Queries: Get (single) and GetAll routes (with matching schemas/services) - use prisma entity for business context..
4. Ensure services inject repositories via constructors, throw feature-appropriate domain errors on missing entities, and never instantiate repositories inline.
5. Make sure every route uses its dedicated schema file and that Fastify module augmentation covers the decorated types.

If the Prisma model isn’t provided or is ambiguous, ask the user for it before proceeding.
